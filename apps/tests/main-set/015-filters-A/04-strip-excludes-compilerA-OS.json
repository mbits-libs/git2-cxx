{
    "$schema": "../../../../tools/json_tests/schema.json",
    "args": "report -f strip-excludes '$DATA/extensions/report-strip.json' -- --os OS --compiler compilerA",
    "post": [
        "show HEAD:main.cc"
    ],
    "patches": {
        "\u001b\\[31m\\[main [0-9a-fA-F]+\\]\u001b\\[m (.*)": "\u001b[31m[main $REPORT]\u001b[m \\1",
        " \u001b\\[2;37mcontains [0-9a-fA-F]+:\u001b\\[m (.+)": " \u001b[2;37mcontains $BUILD:\u001b[m \\1"
    },
    "expected": [
        0,
        [
            "\u001b[31m[main $REPORT]\u001b[m Commit \"extensions\"",
            " one file, \u001b[31m 29%\u001b[m (2/7, -5), Fn\u001b[31m 25%\u001b[m (1/4)",
            " \u001b[2;37mbased on\u001b[m \u001b[2;33m98d4978ec@main\u001b[m",
            " parent 45c01b5bd",
            " \u001b[2;37mcontains $BUILD:\u001b[m \u001b[31m 29%\u001b[m",
            "",
            "file main.cc",
            "blob 8413b254a0751500a3f50ecb1dd93ae4fbf12658",
            "functions 14f0e1233783a10d5073ddcd060500201cf35c29",
            "lines 901e3f666456f35c146cbd93cb9b95b2ad1fa5c0",
            "stats 40 7 2, 4 1, 0 0",
            "",
            "+-----------+--------------+---------+--------------+---------+----------+---------+------------+",
            "| Name      |   % Funcs    | Missing |   % Lines    | Visited | Relevant | Missing | Line count |",
            "+-----------+--------------+---------+--------------+---------+----------+---------+------------+",
            "|   main.cc | 25.00 +25.00 |    3 +3 | 28.57 +28.57 |    2 +2 |     7 +7 |    5 +5 |     40 +40 |",
            "+-----------+--------------+---------+--------------+---------+----------+---------+------------+",
            "",
            "  1 |    |  module;",
            "  2 |    |  import std;",
            "  3 |    |  ",
            "      0x | partial_function_exclusion1",
            "  4 | 0x | -void partial_function_exclusion() /*after*/ {",
            "  5 | 0x | -    line1();",
            "  6 |    |  // GCOV_EXCL_START[OS]",
            "  7 |    |      line2();",
            "  8 |    |      line3();",
            "  9 |    |      line4();",
            " 10 |    |  }",
            " 11 |    |  ",
            " 12 |    |  // GCOV_EXCL_STOP",
            " 13 |    |  ",
            "      0x | sep1",
            " 14 | 4x | +void sep1() {}",
            " 15 |    |  // GCOV_EXCL_START",
            " 16 |    |  ",
            "      0x | partial_function_exclusion2",
            " 17 |    |  void partial_function_exclusion1() /*before*/ {",
            " 18 |    |      line1();",
            " 19 |    |      line2();",
            " 20 |    |  // GCOV_EXCL_STOP",
            " 21 | 0x | -    line3();",
            " 22 | 0x | -    line4();",
            " 23 | 0x | -}",
            " 24 |    |  ",
            "      1x | sep2",
            " 25 | 5x | +void sep2() {}",
            " 26 |    |  ",
            "\n"
        ],
        "strip-excludes: excluded 18 lines, 2 functions\n"
    ],
    "prepare": [
        "unpack $DATA/extensions.tar $TMP",
        "cd '$TMP/extensions'"
    ]
}
